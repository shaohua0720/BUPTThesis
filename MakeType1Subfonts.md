# 介绍 #

利用 mkfnc70 工具可以在 Linux/Unix/Mac OS X/Cygwin 下方便的制作用于 CJK 宏包（UTF-8 编码）的 Type 1 子集字体文件及其辅助文件。使用 mkfnc70 需要具备下列应用程序：

  * Bash
  * awk/gawk
  * perl
  * fontforge
  * 安装了 CJK 宏包的 TeX 发行版本

如果在运行 mkfnc70 的系统上没有安装这些应用程序，请参考系统管理文档安装。

# 下载与安装 #
有多种途径获得最新的 mkfnc70：

  * 从 BUPTThesis 项目主页的[下载页面](http://code.google.com/p/buptthesis/downloads/list)上下载最新的稳定版本 zip 压缩包，mkfnc70-x.y.zip 并将其解压做到任意路径；或者
  * 从 [GitHub](https://github.com/dazzlezhang/mkfnc70) 上下在最新的开发版本：
```
git clone git://github.com/dazzlezhang/mkfnc70.git
```

下面的描述假设 mkfnc70 的解压路径为 $PREFIX，即在 $PREFIX 目录下有下列文件：
```
changes  fontlist.example  helper  mkfnc70  README
```

# 使用方法 #
使用 mkfnc70 前首先需要准备一个输入文件用以描述下列信息：
  * 字体厂商，
> - CJK 宏包中的字族名称，以及
> - 用于产生 Type 1 子集字体的 TrueType 字体所在的路径。

首先创建一个工作目录，例如 $WORKDIR/。在 $WORKDIR/ 下, 复制一份 mkfnc70 附带的示例输入文件：
```
cp $PREFIX/fontlist.example $WORKDIR/fontlist
```
你可以使用任何文本编辑器对 $WORKDIR/fontlist 进行修改。需要注意的是，fontlist 中的 TrueType 字体路径必须是绝对路径或者是相对与 $WORKDIR 的相对路径，例如在 $WORKDIR  下创建一个指向 TrueType 字体所在目录的符号链接：
```
ln -s <path_to_truetype_fonts> $WORKDIR/truetype
```
这样在 fontlist 中就可以用 truetype/xxx.ttf 指明 TrueType 字体路径了。

修改好 fontlist 后切换到 $WORKDIR 目录下并执行 mkfnc70：
```
$PREFIX/mkfnc70 fontlist
```
首先会显示当前 mkfnc70 的版本信息，例如：
```
This is mkfnc70, Version 1.1 (2012/08/31)
```
然后 mkfnc70 需要在当前系统下搜索一系列的辅助程序/文件的路径，这可能会需要一段时间。另外，如果当前用户对某些系统路径没有读权限时，可能会看到类似下面的提示：
```
find: `/usr/lib64/audit': Permission denied
```
如果看到这样得提示，你不需要做任何操作。

完成路径搜索后，mkfnc70 会开始将为 fontlist 中列出的每一个 TrueType 字体制作对应的 Type 1 子集字体和相关的辅助文件。字体转换过程相对比较较慢，请耐心等待。当所有字体都转换完后，会看到下面得提示：
```
Congratulations! 

Type 1 subfonts and auxiliary files are ready. Run `./install' to
install the generated fonts to your $TEXMFHOME.
```

至此，所有生成的文件将按照 TeX 目录结构（TeX directory structure，TDS）存放在 $WORKDIR/texmf 目录下。除此之外，在 $WORKDIR 下还会产生一个安装脚本 install。

最后，你可以在 $WORKDIR 下执行
```
./install
```
将产生的字体文件安装到你的 $TEXMFHOME 目录下。首先安装脚本会询问是否确定要安装到 $TEXMFHOME
```
This is the installation script generated by mkfnc70. 
All files and directories under ./texmf will be installed to
TEXMFHOME.
Are you sure you want to continue with the installation process (y/n)?
```
确认后安装脚本将复制文件并执行相应得更新操作。

当然，你也可以手动将 $WORKDIR/texmf 下的所有文件安装到其他目录。如果选择手动安装，还需要：
  * 执行 texhash 更新 TeX 的文件名数据库；以及
  * 执行 updmap 激活每一个字体的 map 文件。

完成安装后可以用下面的 TeX 文件测试安装的字体是否成功：
```
\documentclass{article}
\usepackage{CJKutf8}
\begin{document}
\begin{CJK*}{UTF8}{song}
\CJKfamily{song}测试
%\CJKfamily{hei}测试
\end{CJK*}
\end{document}
```
请根据本次安装的字体名称对上面的 TeX 文件做适当修改。